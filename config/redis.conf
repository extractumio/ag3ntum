# Redis configuration for Ag3ntum
# Security-focused configuration

# Disable persistence (ephemeral SSE events only)
save ""
appendonly no

# Network configuration
# Bind to all interfaces inside Docker (port mapping handles external access control)
bind 0.0.0.0

# Protected mode (automatically enabled when no password and not bound to localhost)
# Not needed here since Docker port mapping restricts to 127.0.0.1
protected-mode no

# Memory management
maxmemory 256mb
maxmemory-policy allkeys-lru

# Disable dangerous commands for production
# Tests need FLUSHDB, so keep it enabled for now
# To disable in production, uncomment:
# rename-command FLUSHDB ""
# rename-command FLUSHALL ""
# rename-command CONFIG ""
# rename-command SHUTDOWN ""
# rename-command DEBUG ""

# Performance tuning
tcp-backlog 511
timeout 0
tcp-keepalive 300

# Logging
loglevel notice

# Disable RDB compression (we don't persist)
rdbcompression no

# Disable AOF rewrite
auto-aof-rewrite-percentage 0

# Client output buffer limits (prevent slow clients from blocking)
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Pub/Sub optimization
hz 10
dynamic-hz yes

# Security: Disable potentially dangerous commands
rename-command KEYS ""
rename-command SHUTDOWN SHUTDOWN_AG3NTUM
rename-command DEBUG DEBUG_AG3NTUM
